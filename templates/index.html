<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Agribot - Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap (optional for some layout help) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body {
            background: #edf4ea;
            min-height: 100vh;
        }
        html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

        .chat-container {
            max-width: 520px;
            margin: 50px auto 0 auto;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 4px 24px rgba(73,124,46,0.04);
            display: flex;
            flex-direction: column;
            height: 75vh;
            overflow: hidden;
        }
        .chat-container {
    width: 100vw;
    height: 100vh;
    max-width: none;
    margin: 0;
    border-radius: 0;
    box-shadow: none;
    display: flex;
    flex-direction: column;
    background: #fff;
    overflow: hidden;
}

        .chat-header {
            font-size: 1.6rem;
            padding: 22px 28px 16px 28px;
            color: #427532;
            font-weight: 700;
            background: #f1f8ee;
        }
        .chat-body {
            padding: 0 24px 12px 24px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .chat-body {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 18px;
    padding-bottom: 12px;
    padding-top: 0;
}

        .chat-message {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            padding-bottom: 4px;
        }
        .chat-message.user {
            justify-content: flex-end;
        }
        .chat-bubble {
            max-width: 68%;
            padding: 14px 18px;
            border-radius: 20px;
            background: #e2f6d6;
            color: #325422;
            font-size: 1.1rem;
            box-shadow: 0 2px 10px rgba(73,124,46,0.04);
            word-break: break-word;
        }
        .chat-message.user .chat-bubble {
            background: #a6e79f;
            color: #26551c;
            border-bottom-right-radius: 7px;
            border-bottom-left-radius: 20px;
        }
        .chat-message.bot .chat-bubble {
            background: #f0f0f0;
            color: #497c2e;
            border-bottom-left-radius: 7px;
            border-bottom-right-radius: 20px;
        }
        .chat-footer button.btn-success {
    font-size: 1rem;   /* Larger font */
    padding: 10px 18px;  /* More padding */
    min-width: 100px;    /* Optional: wider button */
    border-radius: 10px; /* Optional: slightly rounder */
}

        .avatar {
            width: 38px;
            height: 58px;
            border-radius: 50%;
            object-fit: cover;
        }
        .chat-footer {
            padding: 16px 24px;
            background: #f9fcf7;
            border-top: 1px solid #e1e1e1;
        }
        .chat-footer form {
            display: flex;
            gap: 8px;
        }
        .chat-footer input {
            flex: 1;
        }
        @media (max-width: 600px) {
            .chat-container { max-width: 98vw; height: 95vh;}
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            Agribot <span style="font-size:1em;">ðŸŒ±</span>
        </div>
        <div class="chat-body" id="chat-body">
            <!-- Messages dynamically inserted here -->
        </div>
        <div class="chat-footer">
            <form id="chat-form" autocomplete="off">
                <input type="text" id="user-input" class="form-control" placeholder="Ask your query..." required autofocus>
                <button type="submit" class="btn btn-success">Ask</button>
            </form>
        </div>
    </div>

    <script>
        const chatBody = document.getElementById('chat-body');
        const form = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');

        // Optional: avatars, change these if desired
        const userAvatar = "https://api.dicebear.com/7.x/bottts/svg?seed=User"; // placeholder, change or use your own image
        const botAvatar  = "https://api.dicebear.com/7.x/bottts/svg?seed=Agribot"; // placeholder, change or use your own image

        // Persist messages in page state
        let messages = [];

        // Render chat history
        function renderMessages() {
            chatBody.innerHTML = "";
            messages.forEach(msg => {
                const msgDiv = document.createElement("div");
                msgDiv.className = "chat-message " + msg.sender;
                msgDiv.innerHTML = `
                    ${msg.sender === "bot" ? `<img src="${botAvatar}" class="avatar" alt="Bot">` : ""}
                    <div class="chat-bubble">${msg.text}</div>
                    ${msg.sender === "user" ? `<img src="${userAvatar}" class="avatar" alt="User">` : ""}
                `;
                chatBody.appendChild(msgDiv);
            });
            // Auto-scroll to bottom
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        form.onsubmit = async (e) => {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            // Display user message
            messages.push({sender: "user", text});
            renderMessages();
            userInput.value = "";
            userInput.focus();

            // Show bot "thinking" message
            messages.push({sender: "bot", text: "<em>Thinking...</em>"});
            renderMessages();

            try {
                const resp = await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: "query=" + encodeURIComponent(text)
                });
                const data = await resp.json();

                // Replace the "Thinking..." placeholder with actual response
                messages[messages.length - 1].text = data.response;
                renderMessages();
            } catch (error) {
                messages[messages.length - 1].text = "Sorry, something went wrong.";
                renderMessages();
            }
        };

        // Initial hello from bot
        window.onload = function() {
            messages.push({
                sender: "bot",
                text: "Hello! ðŸ‘‹ Iâ€™m Agribot. Ask me anything about agriculture."
            });
            renderMessages();
        };
    </script>
</body>
</html>
